---
import Icon from "@components/react-components/icons/Icon";
import { InfoIcon } from "lucide-preact";
import { GET } from "~/pages/api/users/loggedinuser";

interface Props {
  title: string;
}
const { title } = Astro.props;
const origin = Astro.url.origin;
let isLoggedIn: string = "";
const response = await GET({ ...Astro, ResponseWithEncoding: Response });
if (!(response instanceof Response)) return Astro.redirect("/404");
const result = await response.json();
if (result.username) isLoggedIn = result.username;
---

<!doctype html>
<html lang="en" class="w-screen h-screen">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Astro description" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class="w-full h-full bg-base-300 fixed">
    <main class="w-full h-full grid items-center">
      <div class="w-full">
        <div class="flex flex-col w-full items-center mb-8">
          <div class="flex flex-row gap-4 h-fit w-fit">
            <span class="text-[#1888f2]"><Icon height={60} width={60} /></span
            ><span class="text-6xl font-light">Kvitter</span>
          </div>
        </div>
        <div class="w-full h-full flex flex-col items-center">
          <slot />
        </div>
      </div>
      {
        isLoggedIn && (
          <div class="alert w-11/12 absolute justify-self-center self-end mx-4 mb-4">
            <span class="text-info">
              <InfoIcon height={32} width={32} />
            </span>
            <p class="text-lg">You are already logged in</p>
            <a href={`${origin}/`} class="btn btn-outline btn-info btn- btn-sm">
              Go to home
            </a>
          </div>
        )
      }
    </main>
  </body>
</html>
