---
import Avatar from "./blocks/Avatar";
import { GET } from "~/pages/api/loggedinuser";

const response = await GET(Astro);
if (!(response instanceof Response)) return Astro.redirect("/404");
const { username, role } = await response.json();
const origin = Astro.url.origin;
---

<header class="navbar bg-base-100 rounded-b-lg z-50 relative">
  <div class="flex-1">
    <a href=`${origin}/` class="btn btn-ghost text-xl" data-astro-prefetch
      >Kvitter</a
    >
  </div>
  <div class="flex-none z-85">
    <div class="dropdown dropdown-left dropdown-hover z-90">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
        <div class="rounded-full grid">
          <Avatar />
        </div>
      </div>
      <ul class="menu dropdown-content bg-base-200 rounded-box w-52 z-900">
        <li><a href={`${origin}/user/${username}`}>Profile</a></li>
        {
          role === "admin" && (
            <li>
              <a href={`${origin}/admin`}>Admin</a>
            </li>
          )
        }
        <li><a href={`${origin}/settings`}>Settings</a></li>
        <li><a href="">Log out</a></li>
      </ul>
    </div>
  </div>
</header>
